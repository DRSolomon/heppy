#!/usr/bin/env python

# This is message queue subscribing version based on RabbitMQ and pika.

import json
import signal

from pprint import pprint

from heppy.EPP import REPP
from heppy.Args import Args
from heppy.Error import Error
from heppy.Config import Config
from heppy.Daemon import Daemon
from heppy.RabbitMQ import RPCServer
from heppy.SignalHandler import SignalHandler

args = Args()
config = Config(args.get('path'))

def hello():
    print "\nHELLO\n"

handler = SignalHandler(hello)

def response(query):
    with handler.block_signals():
        print  "query is: " + query
        return "reply is: " + query

server = RPCServer(config)
server.consume(response)

print 'FINISHED'
