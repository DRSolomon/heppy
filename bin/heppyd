#!/usr/bin/env python

# This is message queue subscribing version based on RabbitMQ and pika.

import json

from subprocess import Popen

from pprint import pprint

from heppy.EPP import REPP
from heppy.Args import Args
from heppy.Error import Error
from heppy.Config import Config
from heppy.Daemon import Daemon
from heppy.RabbitMQ import RPCServer

args = Args()
config = Config(args.get('path'))

daemon = Daemon(config)
daemon.start(args)

def response(query):
    print  "query is:  " + query
    return "query was: " + query

server = RPCServer(config)
server.consume(response)

print 'FINISHED'
