#!/usr/bin/env python

import json

from pprint import pprint

from reppy import Args
from reppy import Request
from reppy import Response

from reppy.Error import Error
from reppy.Client import Client

data = Args.parse()

with open(data['path']) as file:
    config = json.load(file)

try:
    request = Request.build(data['command'], data)
    xml = request.toprettyxml()
    print xml
    client = Client(config['local']['address'])
    res = client.command(xml)
    print res
    response = Response.build(data['command'], res)
    pprint(response.data)
except Exception as e:
    Error.die(3, e)

